var DTape=function(){that=this};DTape.prototype={tokens:[],variables:{global:{}},functions:{},bytecode:[]};DTape.prototype.error=function(e){console.log(e)};DTape.prototype.display=function(s){switch(typeof s){case"object":console.log(s);break;case"string":console.log('"'+s+'"');break;case"number":console.log(s);break;default:that.error("Can't recognize command "+s)}};DTape.prototype.syntax={OPERATOR:{"+":"ADD","-":"SUBTRACT","*":"MULTIPLY","/":"DIVIDE","%":"MODULO"},LOGICAL:{"&&":"AND","||":"OR"},COMPARISON:{"==":"EQUAL","!=":"NOT_EQUAL","<>":"NOT_EQUAL","<=":"LEQ",">=":"GEQ",">":"GT","<":"LT"},BRACKET:{"(":"ROUND_OPEN",")":"ROUND_CLOSE","[":"SQUARE_OPEN","]":"SQUARE_CLOSE","{":"CURLY_OPEN","}":"CURLY_CLOSE"},SYMBOL:{",":"COMMA",";":"SEMICOLON",$:"DOLLAR","#":"HASH","!":"BANG","=":"ASSIGNMENT","?":"QUESTION_MARK",":":"COLON","|":"PIPE"}};DTape.prototype.addToken=function(type,value){this.tokens.push({type:type,value:value})};DTape.prototype.tokenize=function(s){var len=s.length;var pos=0;this.tokens=[];while(pos<len){matched=false;ch=s.charAt(pos);la=pos==len-1?null:s.charAt(pos+1);pr=pos==0?null:s.charAt(pos-1);if(ch==" "){pos++;continue}if(ch>="a"&&ch<="z"||ch>="A"&&ch<="Z"){rst=s.substr(pos+1).match(/^[a-zA-Z0-9_]*/);this.addToken("STRING_LITERAL",rst==null?ch:ch+rst[0]);pos+=rst==null?1:(ch+rst[0]).length;delete rst;continue}if(ch>="0"&&ch<="9"||ch=="."&&(la!=null&&la>="0"&&la<="9")){rst=s.substr(pos+1).match(/^[0-9]*(\.[0-9]+)?(e-?[0-9]+)?/);this.addToken("NUMBER",rst==null?ch:ch+rst[0]);pos+=rst==null?1:(ch+rst[0]).length;delete rst;continue}if(pr==")"||pr>=0&&pr<=9||pr>="a"&&pr<="z"||pr>="A"&&pr<="Z"||pr=="]"){this.addToken("SYMBOL_APOSTROPHE","'");pos++;continue}if(ch=="'"){rst=s.substr(pos+1).match(/^([^']*)'/);if(rst==null&&la!="'"){this.error("Unmatched string quote");break}this.addToken("STRING",rst==null?"":rst[1]);pos+=rst==null?1:(ch+rst[0]).length;delete rst;continue}if(ch=="/"&&la=="/"){break}for(group in this.syntax){if(!this.syntax.hasOwnProperty(group))continue;if(this.syntax[group][ch+la]||this.syntax[group][ch]){this.addToken(group+"_"+(this.syntax[group][ch+la]?this.syntax[group][ch+la]:this.syntax[group][ch]),this.syntax[group][ch+la]?ch+la:ch);matched=this.tokens[this.tokens.length-1].value.length;break}}if(matched){pos+=matched;continue}that.error("Unrecognized: '"+ch+"' ["+pos+"]");return;pos++}delete ch,la,pos,matched;return this.tokens};DTape.prototype.parse=function(){ln=this.tokens.length;pr=this.parse;if(ln==1){pr.oneToken();return true}if(ln>2&&this.tokens[0].type=="STRING_LITERAL"&&this.tokens[1].type=="SYMBOL_ASSIGNMENT"){pr.assignment();return true}this.error("tooo complicated at this point");delete ln,pr;return true};DTape.prototype.parse.addInstruction=function(name,obj){that.bytecode[parseInt(that.bytecode.length)]=[];that.bytecode[parseInt(that.bytecode.length)-1][name]=obj};DTape.prototype.parse.oneToken=function(){var token=that.tokens[0];if(token.value=="#"){console.log(that.bytecode);return}switch(token.type){case"STRING_LITERAL":case"NUMBER":case"STRING":pr.addInstruction("display",{value:token.value,type:token.type});return;break;default:that.error('Command "'+token.value+'" unrecognized')}};DTape.prototype.parse.assignment=function(){if(that.tokens[2].type!=="NUMBER"&&that.tokens[2].type!=="STRING"){that.error("I can't do this assignment yet.");return false}if(ln==3){pr.addInstruction("assign",{name:that.tokens[0].value,value:that.tokens[2].value,type:that.tokens[2].type});return true}that.error("Can't do this yet");return false};DTape.prototype.interpret=function(){bc=that.bytecode;for(j in bc){}return true};var readline=require("readline"),rl=readline.createInterface(process.stdin,process.stdout),prefix="> ";var dtsess=new DTape;rl.on("line",function(line){if(line[0]=="?")console.log(dtsess.tokenize(line.substr(1,line.length)));else dtsess.tokenize(line);dtsess.parse();dtsess.interpret();rl.prompt()}).on("close",function(){console.log("Kthxbye!");process.exit(0)});console.log(prefix+"Welcome");rl.setPrompt(prefix,prefix.length);rl.prompt();